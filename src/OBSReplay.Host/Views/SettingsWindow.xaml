<Window x:Class="OBSReplay.Host.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Replay Overlay Settings"
        Width="400" MinHeight="640"
        SizeToContent="Height"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="#1a1a2e">

    <Window.Resources>
        <!-- Shared dark theme styles -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#e94560"/>
            <Setter Property="Margin" Value="0,12,0,6"/>
        </Style>
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#eaeaea"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="#16213e"/>
            <Setter Property="Foreground" Value="#eaeaea"/>
            <Setter Property="BorderBrush" Value="#2c3e50"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="4,3"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="#eaeaea"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Margin" Value="0,3"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#16213e"/>
            <Setter Property="Foreground" Value="#eaeaea"/>
            <Setter Property="BorderBrush" Value="#2c3e50"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="4,3"/>
        </Style>
        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#16213e"/>
            <Setter Property="Foreground" Value="#eaeaea"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="4,3"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#0f3460"/>
                    <Setter Property="Foreground" Value="#eaeaea"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0f3460"/>
                    <Setter Property="Foreground" Value="#eaeaea"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <!-- Dark ComboBox with opaque dropdown -->
        <ControlTemplate x:Key="DarkComboBoxTemplate" TargetType="ComboBox">
            <Grid>
                <ToggleButton x:Name="ToggleButton"
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                    Focusable="False" ClickMode="Press">
                    <ToggleButton.Template>
                        <ControlTemplate TargetType="ToggleButton">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="1" CornerRadius="2" Padding="4,3,20,3">
                                <ContentPresenter HorizontalAlignment="Left" VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </ToggleButton.Template>
                </ToggleButton>
                <ContentPresenter x:Name="ContentPresenter" IsHitTestVisible="False"
                    Content="{TemplateBinding SelectionBoxItem}"
                    ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                    ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}"
                    Margin="6,3,20,3" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                <Popup x:Name="Popup" Placement="Bottom"
                    IsOpen="{TemplateBinding IsDropDownOpen}"
                    AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                    <Grid x:Name="DropDown"
                        MinWidth="{TemplateBinding ActualWidth}"
                        MaxHeight="{TemplateBinding MaxDropDownHeight}">
                        <Border Background="#1a1a2e" BorderBrush="#2c3e50"
                            BorderThickness="1" CornerRadius="2" Padding="1"/>
                        <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Contained"/>
                        </ScrollViewer>
                    </Grid>
                </Popup>
            </Grid>
        </ControlTemplate>
        <Style x:Key="BrowseButton" TargetType="Button">
            <Setter Property="Content" Value="..."/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Background" Value="#2c3e50"/>
            <Setter Property="Foreground" Value="#eaeaea"/>
            <Setter Property="BorderBrush" Value="#2c3e50"/>
            <Setter Property="Margin" Value="4,0,0,0"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>
        <Style x:Key="AccentButton" TargetType="Button">
            <Setter Property="Background" Value="#e94560"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#e94560"/>
            <Setter Property="Padding" Value="16,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style x:Key="CancelButton" TargetType="Button">
            <Setter Property="Background" Value="#2c3e50"/>
            <Setter Property="Foreground" Value="#eaeaea"/>
            <Setter Property="BorderBrush" Value="#2c3e50"/>
            <Setter Property="Padding" Value="16,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </Window.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
        <StackPanel>
            <!-- OVERLAY Section -->
            <TextBlock Style="{StaticResource SectionHeader}" Text="OVERLAY"/>

            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="Watch Folder"/>
                <TextBox Grid.Column="1" x:Name="WatchFolderBox"/>
                <Button Grid.Column="2" Content="Detect" Margin="4,0,0,0"
                        Background="#2c3e50" Foreground="#eaeaea" BorderBrush="#2c3e50"
                        FontSize="10" Padding="6,2" Click="DetectFolder_Click"/>
                <Button Grid.Column="3" Style="{StaticResource BrowseButton}" Click="BrowseFolder_Click"/>
            </Grid>

            <CheckBox x:Name="SyncObsFolderCb" Content="Sync recording folder automatically"/>

            <Grid Margin="0,4,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="60"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="Duration (s)"/>
                <TextBox Grid.Column="1" x:Name="NotificationDurationBox"/>
                <TextBlock Grid.Column="2" Style="{StaticResource FieldLabel}" Text="Opacity %" Margin="12,0,8,0"/>
                <TextBox Grid.Column="3" x:Name="NotificationOpacityBox"/>
            </Grid>

            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="Message"/>
                <TextBox Grid.Column="1" x:Name="NotificationMessageBox"/>
            </Grid>

            <CheckBox x:Name="ShowRecIndicatorCb" Content="Show REC indicator"/>

            <Grid Margin="0,4,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="REC Position"/>
                <ComboBox Grid.Column="1" x:Name="RecPositionCombo"
                          Template="{StaticResource DarkComboBoxTemplate}"
                          Background="#16213e" BorderBrush="#2c3e50" Foreground="#eaeaea">
                    <ComboBoxItem Content="top-left"/>
                    <ComboBoxItem Content="top-center"/>
                    <ComboBoxItem Content="top-right"/>
                    <ComboBoxItem Content="bottom-left"/>
                    <ComboBoxItem Content="bottom-center"/>
                    <ComboBoxItem Content="bottom-right"/>
                </ComboBox>
            </Grid>

            <!-- CONNECTION Section -->
            <TextBlock Style="{StaticResource SectionHeader}" Text="CONNECTION"/>

            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="App Path"/>
                <TextBox Grid.Column="1" x:Name="ObsPathBox"/>
                <Button Grid.Column="2" Style="{StaticResource BrowseButton}" Click="BrowseObs_Click"/>
            </Grid>

            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="80"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="Port"/>
                <TextBox Grid.Column="1" x:Name="ObsPortBox"/>
                <TextBlock Grid.Column="2" Style="{StaticResource FieldLabel}" Text="Password" Margin="12,0,8,0"/>
                <TextBox Grid.Column="3" x:Name="ObsPasswordBox"/>
            </Grid>

            <CheckBox x:Name="AutoLaunchObsCb" Content="Auto-launch streaming software"/>
            <CheckBox x:Name="AutoLaunchMinimizedCb" Content="Launch minimized" Margin="20,3,0,3"/>
            <CheckBox x:Name="OrganizeByGameCb" Content="Organize replays by game"/>
            <CheckBox x:Name="AutoStartBufferCb" Content="Auto-start replay buffer on connect"/>

            <!-- HOTKEY Section -->
            <TextBlock Style="{StaticResource SectionHeader}" Text="HOTKEY"/>

            <CheckBox x:Name="HotkeyEnabledCb" Content="Enable hotkeys"/>

            <Grid Margin="0,4,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="Save Replay"/>
                <TextBox Grid.Column="1" x:Name="SaveHotkeyBox"/>
            </Grid>

            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Style="{StaticResource FieldLabel}" Text="Toggle Overlay"/>
                <TextBox Grid.Column="1" x:Name="ToggleHotkeyBox"/>
                <Button Grid.Column="2" Content="Sync" Margin="8,0,0,0"
                        Background="#2c3e50" Foreground="#eaeaea" BorderBrush="#2c3e50"
                        FontSize="10" Padding="8,3" Click="SyncFromObs_Click"/>
            </Grid>

            <CheckBox x:Name="RunAsAdminCb" Content="Run as Administrator"/>

            <!-- SYSTEM Section -->
            <TextBlock Style="{StaticResource SectionHeader}" Text="SYSTEM"/>

            <CheckBox x:Name="StartWithWindowsCb" Content="Start with Windows"/>

            <!-- Buttons -->
            <Grid Margin="0,20,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <Button Grid.Column="1" Style="{StaticResource CancelButton}"
                        Content="Cancel" Margin="0,0,8,0" Click="Cancel_Click"/>
                <Button Grid.Column="2" Style="{StaticResource AccentButton}"
                        Content="Save" Click="Save_Click"/>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</Window>
